{"version":3,"sources":["../../../../assets/scripts/assets/scripts/GameInit.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../assets/scripts","sourcesContent":["// 游戏初始化 所有单例管理类的实例委托到 cc.talefun,调用时(<any>cc).talefun.sigleton.method\n//也可以 模块开始位置定义 let talefun = (<any>cc).talefun; 方法中调用 talefun.singleton.method （推荐）\n//或 模块开始位置定义 let sigleton = (<any>cc).talefun.singleton; 方法中调用 singleton.method (注意：当模块加载顺序有变化，可能造成访问变量singleton为undefined)\n// 生成全局变量防止引用模块时，造成循环引用，避免循环引用的另一种方法是 事件注册和分发\n// 2018.01.09 li.xiao\n\n// (function() {\n//     let wx = window[\"wx\"];\n//     if (wx != undefined && wx != null) {\n//         wx.onShow(function() {\n//             cc.log(\"=======================on show wx\");\n//         });\n//         cc.log(\"=======================on show function 1\");\n//     }\n//     cc.log(\"=======================on show function 2\");\n// })();\n\n(<any>cc).talefun = {};\n\n//初始化 LogHelper,用于控制日志输出\nimport LogHelper from \"./tools/LogHelper\";\n(<any>cc).talefun.LogHelper =  LogHelper;\n\n//初始化 本地化 文件\nimport langStr from \"./template/Lang\";\nimport Localization from \"./tools/Localization\";\nLocalization.initLangCache(langStr);\n(<any>cc).talefun.Localization =  Localization;\n\n//初始化 UIResMap,用于自动加载纹理\nimport UIResMap from \"./template/UIResMap\";\nUIResMap.initUIResMap();\n(<any>cc).talefun.UIResMap =  UIResMap;\n\n//初始化SDKManager，用于对接不同平台接口\nimport SDKManager from \"./platform/SDKManager\";\n(<any>cc).talefun.SDKManager =  SDKManager.getInstance();\n\n//初始化 EventManager,用于用户事件管理\nimport EventManager from \"./event/EventManager\";\n(<any>cc).talefun.EventManager = EventManager.getInstance();\n\nimport EventType from \"./event/EventType\";\n(<any>cc).talefun.EventType =  EventType;\n\n//初始化 AudioManager，用于音效管理\nimport AudioManager from \"./audio/AudioManager\";\n(<any>cc).talefun.AudioManager =  AudioManager.getInstance();\n\n//初始化 TemplateManager，用于静态文件加载管理\nimport TemplateManager from \"./template/TemplateManager\";\n(<any>cc).talefun.TemplateManager =  TemplateManager.getInstance();\n\n//初始化 缓存数据，用于动态数据加载管理\nimport ObjectManager from \"./object/ObjectManager\";\n(<any>cc).talefun.ObjectManager =  ObjectManager.getInstance();\n\n//初始化 ViewManager，用于ui管理\nimport ViewManager from \"./viewCtrl/ViewManager\";\n(<any>cc).talefun.ViewManager =  ViewManager.getInstance();\n\n//初始化 NetworkManager，用于ui管理\nimport NetworkManager from \"./network/NetworkManager\";\n(<any>cc).talefun.NetworkManager =  NetworkManager.getInstance();\n\nconst {ccclass, property} = cc._decorator;\n\n\n@ccclass\nexport default class GameInit extends cc.Component {\n\n    designWidth:number = 640;\n    designHeight:number = 1136;\n\n    designScreenWidth:number = 640;\n    designScreenHeight:number = 1136;\n\n    designScale = 1;\n\n    _thisOnResized:any = null; \n\n    onLoad () {\n        // console.log(`talefun debug ${talefun.debug}`);\n        // console.log(this.name);\n        this.fixDesignSolution();\n\n        // this.rigisterSizeChangeEvent();\n\n        (<any>cc).talefun.LogHelper.log(`event type : ${(<any>cc).talefun.EventType.EVENT_USER_TEST}`);\n\n        (<any>cc).talefun.ObjectManager.initModelData();\n        (<any>cc).talefun.NetworkManager.initNetwork();\n        cc.director.getPhysicsManager().enabled = true;\n        // cc.director.getPhysicsManager().debugDrawFlags = cc.PhysicsManager.DrawBits.e_aabbBit |\n        // cc.PhysicsManager.DrawBits.e_pairBit |\n        // cc.PhysicsManager.DrawBits.e_centerOfMassBit |\n        // cc.PhysicsManager.DrawBits.e_jointBit |\n        // cc.PhysicsManager.DrawBits.e_shapeBit\n        ;\n        cc.director.getPhysicsManager().gravity = cc.v2(0, -300);\n\n        var promise1 = new Promise(function(resolve, reject) {\n            setTimeout(resolve, 100, 'foo');\n        });\n\n        cc.director.setDisplayStats(true);\n    }\n\n    fixDesignSolution()\n    {\n        let frameSize = (<any>cc.view).getCanvasSize()\n        let policy, e = cc.ResolutionPolicy;\n        policy = e.FIXED_HEIGHT;\n\n        let designRes = cc.size(this.designWidth,this.designHeight);\n \n        let w = frameSize.width, h = frameSize.height;\n        let scaleX = w / designRes.width, scaleY = h / designRes.height;\n        scaleX < scaleY ? (designRes.width = designRes.width, designRes.height = Math.ceil(h / scaleX) ) : (designRes.width = Math.ceil(w / scaleY) , designRes.height = designRes.height);\n\n        this.designScreenWidth = designRes.width;\n        this.designScreenHeight = designRes.height;\n\n        this.designScale = this.designScreenWidth/this.designWidth > this.designScreenHeight/this.designHeight ? this.designScreenWidth/this.designWidth : this.designScreenHeight/this.designHeight\n\n        cc.view.setDesignResolutionSize(designRes.width, designRes.height, policy)\n\n\n        let talefun = (<any>cc).talefun;\n        talefun.designWidth = this.designWidth;\n        talefun.designHeight = this.designHeight;\n        talefun.designScreenWidth = this.designScreenWidth;\n        talefun.designScreenHeight = this.designScreenHeight;\n        talefun.designScale = this.designScale;\n\n        // LogHelper.dump(talefun);\n\n    }\n\n    rigisterSizeChangeEvent()\n    {\n        // if (CC_JSB) {\n        //     this._thisOnResized = cc.EventListener.create({\n        //         event: (<any>cc.EventListener).CUSTOM,\n        //         eventName: \"window-resize\",\n        //         callback: this.onResized.bind(this)\n        //     });\n\n        //     this._thisOnResized.retain();\n        // }\n        // else {\n        //     this._thisOnResized = this.onResized.bind(this);\n        // }\n\n        // if (CC_EDITOR) {\n        //     (<any>cc).engine.on('design-resolution-changed', this._thisOnResized);\n        // }\n        // else if (!CC_JSB) {\n        //     if (cc.sys.isMobile) {\n        //         window.addEventListener('resize', this._thisOnResized);\n        //     }\n        //     else {\n        //         (<any>cc.eventManager).addCustomListener('canvas-resize', this._thisOnResized);\n        //     }\n        // }\n        // else {\n        //     cc.eventManager.addListener(this._thisOnResized, 1);\n        // }\n    }\n\n    onResized()\n    {\n        // LogHelper.log(\"onResized\");\n    }\n\n    onDestroy() \n    {\n        // if(this._thisOnResized == null)\n        // {\n        //     return;\n        // }\n        // if (CC_EDITOR) {\n        //     (<any>cc).engine.off('design-resolution-changed', this._thisOnResized);\n        // }\n        // else if (!CC_JSB) {\n        //     if (cc.sys.isMobile) {\n        //         window.removeEventListener('resize', this._thisOnResized);\n        //     }\n        //     else {\n        //         (<any>cc.eventManager).removeCustomListeners('canvas-resize', this._thisOnResized);\n        //     }\n        // }\n        // else {\n        //     cc.eventManager.removeListener(this._thisOnResized);\n        //     this._thisOnResized.release();\n        // }\n    }\n    // update (dt) {},\n}\n"]}