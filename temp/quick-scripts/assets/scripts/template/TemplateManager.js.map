{"version":3,"sources":["TemplateManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\template","sourcesContent":["//模版文件加载管理类\r\n// 2018.01.10 li.xiao\r\n\r\nlet talefun = (<any>cc).talefun\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TemplateManager {\r\n\r\n    static _instance:TemplateManager = null;\r\n     cache = {};\r\n     loadListCallback:any = null;\r\n\r\n    static getInstance():TemplateManager\r\n     {\r\n         if(TemplateManager._instance == null)\r\n         {\r\n            TemplateManager._instance = new TemplateManager();\r\n         }\r\n         return TemplateManager._instance;\r\n     }\r\n\r\n     getTemplate(name:string,callback:any)\r\n    {\r\n        if (name && typeof(name) == \"string\")\r\n        {\r\n            if (this.cache[name] )\r\n            {\r\n                talefun.LogHelper.log(\"load template : \" + name + \" in cache\");\r\n                if (callback)\r\n                {\r\n                    callback(this.cache[name]);\r\n                }\r\n            }\r\n            else\r\n            {\r\n                cc.loader.loadRes(\"template/\" + name,function(error,jsonObjct)\r\n                {\r\n                    if (error)\r\n                    {\r\n                        talefun.LogHelper.log(\"load template \" + name + \" error: \" + error)\r\n                    }\r\n                    else\r\n                    {\r\n                        talefun.LogHelper.log(\"load template : \" + name);\r\n                        (<any>cc).talefun.LogHelper.dump(jsonObjct);\r\n                        this.cache[name] = jsonObjct;\r\n                        if (callback)\r\n                        {\r\n                            callback(jsonObjct);\r\n                        }\r\n                    }\r\n                }.bind(this));\r\n            }\r\n        }\r\n    }\r\n\r\n    getTemplateList(nameList:Array<any>,callback:any)\r\n    {\r\n        this.loadListCallback = callback;\r\n        if (nameList && nameList instanceof Array)\r\n        {\r\n            var len = nameList.length;\r\n            var self = this;\r\n            if (len > 0)\r\n            {\r\n               this.stepLoadTemplate(nameList,len - 1);\r\n            }\r\n            else\r\n            {\r\n                if (this.loadListCallback)\r\n                {\r\n                    this.loadListCallback();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    stepLoadTemplate(list:Array<any>,index:number)\r\n    {\r\n        let len = list.length;\r\n        let idx = index;\r\n        if(len == 0 || index < 0 || index > len -1)\r\n        {\r\n            if (this.loadListCallback)\r\n            {\r\n                this.loadListCallback();\r\n                this.loadListCallback = null;\r\n            }\r\n            return;\r\n        }\r\n        else\r\n        {\r\n            this.getTemplate(list[index],function()\r\n            {\r\n                this.stepLoadTemplate(list,idx -1)\r\n            }.bind(this));\r\n        }\r\n    }\r\n\r\n    getTemplateInCache(name:string)\r\n    {\r\n        if (this.cache)\r\n        {\r\n            return this.cache[name];\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n}\r\n"]}